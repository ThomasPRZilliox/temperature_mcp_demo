<!DOCTYPE html>
<html>
<head>
  <title>FastAPI Frontend</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Status: <span id="status">---</span></h2>
<canvas id="chart" width="400" height="200"></canvas>

<script>
  const ctx = document.getElementById('chart');
  const chart = new Chart(ctx, {
  type: 'line',
  data: {
      labels: [],
      datasets: [{
        label: 'Temperature',
        data: [],
        borderWidth: 1
      }]
    },
  options: {
    animation: false,
    responsive: true,
    maintainAspectRatio: true
    }
  });


  async function update() {
    const r = await fetch('http://127.0.0.1:9999/data');
    const d = await r.json();

    const stateMap = {
      0: 'Idle',
      1: 'Heating',
      2: 'Cooling',
    };

    const stateText = stateMap[d.controller_state] ?? 'Unknown';

    document.getElementById('status').innerText = stateText;
    chart.data.labels.push('');
    chart.data.datasets[0].data.push(d.current_temperature);

    if (chart.data.labels.length > 50) {
      chart.data.labels.shift();
      chart.data.datasets[0].data.shift();
    }

    chart.update();
  }

  setInterval(update, 500);
</script>

</body>
</html>
